# ğŸ™ï¸ Trá»£ LÃ½ AI Giá»ng NÃ³i Vui Váº» (Local)# ğŸ™ï¸ Trá»£ LÃ½ AI Giá»ng NÃ³i Vui Váº» (Local)



Trá»£ lÃ½ AI voice-only **phong cÃ¡ch thÃ¢n thiá»‡n, vui váº», hÃ i hÆ°á»›c** cháº¡y hoÃ n toÃ n local trÃªn macOS:Trá»£ lÃ½ AI voice-only **phong cÃ¡ch thÃ¢n thiá»‡n, vui váº», hÃ i hÆ°á»›c** cháº¡y hoÃ n toÃ n local trÃªn macOS:

- ğŸ¯ **PhoWhisper** (vinai/PhoWhisper-small 157M) - Nháº­n dáº¡ng tiáº¿ng Viá»‡t tá»‘i Æ°u- ğŸ¯ **PhoWhisper** (vinai/PhoWhisper-small 157M) - Nháº­n dáº¡ng tiáº¿ng Viá»‡t tá»‘i Æ°u

- ğŸ¤– **Ollama** (gemma2:2b) - AI tráº£ lá»i vui nhá»™n, tá»± nhiÃªn- ğŸ¤– **Ollama** (gemma2:2b) - AI tráº£ lá»i vui nhá»™n, tá»± nhiÃªn

- ğŸ—£ï¸ **Edge TTS** (Microsoft Neural) - Giá»ng nÃ³i nhÆ° ngÆ°á»i tháº­t- ğŸ—£ï¸ **Edge TTS** (Microsoft Neural) - Giá»ng nÃ³i nhÆ° ngÆ°á»i tháº­t



## âœ¨ TÃ­nh NÄƒng## âœ¨ TÃ­nh NÄƒng



### ğŸ¤ CÃ¡ch Sá»­ Dá»¥ng### ğŸ¤ CÃ¡ch Sá»­ Dá»¥ng

1. **Nháº¥n ENTER** â†’ Báº¯t Ä‘áº§u ghi Ã¢m1. **Nháº¥n ENTER** â†’ Báº¯t Ä‘áº§u ghi Ã¢m

2. **NÃ³i báº¥t cá»© gÃ¬** â†’ Chat tá»± nhiÃªn, há»i chuyá»‡n, Ä‘iá»u khiá»ƒn nhÃ  thÃ´ng minh, ká»ƒ chuyá»‡n cÆ°á»i...2. **NÃ³i báº¥t cá»© gÃ¬** â†’ Chat tá»± nhiÃªn, há»i chuyá»‡n, Ä‘iá»u khiá»ƒn nhÃ  thÃ´ng minh, ká»ƒ chuyá»‡n cÆ°á»i...

3. **Nháº¥n ENTER** láº§n ná»¯a â†’ Dá»«ng vÃ  xá»­ lÃ½3. **Nháº¥n ENTER** láº§n ná»¯a â†’ Dá»«ng vÃ  xá»­ lÃ½

4. **Nghe pháº£n há»“i** â†’ AI tráº£ lá»i vui váº», hÃ i hÆ°á»›c4. **Nghe pháº£n há»“i** â†’ AI tráº£ lá»i vui váº», hÃ i hÆ°á»›c



### ğŸ¯ Phong CÃ¡ch Giao Tiáº¿p### ğŸ¯ Phong CÃ¡ch Giao Tiáº¿p

- âœ… **ThÃ¢n thiá»‡n, gáº§n gÅ©i** - NhÆ° báº¡n bÃ¨ tÃ¢m sá»±- âœ… **ThÃ¢n thiá»‡n, gáº§n gÅ©i** - NhÆ° báº¡n bÃ¨ tÃ¢m sá»±

- âœ… **Vui váº», hÃ i hÆ°á»›c** - CÃ³ thá»ƒ Ä‘Ã¹a cá»£t nháº¹ nhÃ ng- âœ… **Vui váº», hÃ i hÆ°á»›c** - CÃ³ thá»ƒ Ä‘Ã¹a cá»£t nháº¹ nhÃ ng

- âœ… **Tá»± nhiÃªn** - KhÃ´ng cá»©ng nháº¯c, khÃ´ng formal- âœ… **Tá»± nhiÃªn** - KhÃ´ng cá»©ng nháº¯c, khÃ´ng formal

- âœ… **Äa chá»§ Ä‘á»** - Smart home, thá»i tiáº¿t, tÃ¢m sá»±, giáº£i trÃ­...- âœ… **Äa chá»§ Ä‘á»** - Smart home, thá»i tiáº¿t, tÃ¢m sá»±, giáº£i trÃ­...



### âš™ï¸ Quy TrÃ¬nh Xá»­ LÃ½### âš™ï¸ Quy TrÃ¬nh Xá»­ LÃ½

1. **STT** â†’ PhoWhisper (Ä‘á»™ chÃ­nh xÃ¡c cao nháº¥t cho tiáº¿ng Viá»‡t)1. **STT** â†’ PhoWhisper (Ä‘á»™ chÃ­nh xÃ¡c cao nháº¥t cho tiáº¿ng Viá»‡t)

2. **AI** â†’ Ollama phÃ¢n tÃ­ch vÃ  tráº£ lá»i vui váº»2. **AI** â†’ Ollama phÃ¢n tÃ­ch vÃ  tráº£ lá»i vui váº»

3. **TTS** â†’ Edge TTS tá»•ng há»£p giá»ng tá»± nhiÃªn3. **TTS** â†’ Edge TTS tá»•ng há»£p giá»ng tá»± nhiÃªn

4. **Play** â†’ PhÃ¡t Ã¢m thanh pháº£n há»“i4. **Play** â†’ PhÃ¡t Ã¢m thanh pháº£n há»“i



## ğŸ› ï¸ Stack CÃ´ng Nghá»‡ (100% Local)## ğŸ› ï¸ Stack CÃ´ng Nghá»‡ (100% Local)



- **Language**: Go 1.22+- **Language**: Go 1.22+

- **Audio I/O**: FFmpeg AVFoundation- **Audio I/O**: FFmpeg AVFoundation

- **STT**: PhoWhisper **vinai/PhoWhisper-small** (157M) - tá»‘i Æ°u cho tiáº¿ng Viá»‡t- **STT**: PhoWhisper **vinai/PhoWhisper-small** (157M) - tá»‘i Æ°u cho tiáº¿ng Viá»‡t

- **AI**: Ollama gemma2:2b (1.6GB) - phong cÃ¡ch vui váº»- **AI**: Ollama gemma2:2b (1.6GB) - phong cÃ¡ch vui váº»

- **TTS**: Edge TTS Neural Voices (vi-VN-NamMinhNeural)- **TTS**: Edge TTS Neural Voices (vi-VN-NamMinhNeural)



## YÃªu Cáº§u Há»‡ Thá»‘ng## YÃªu Cáº§u Há»‡ Thá»‘ng



- macOS (Apple Silicon hoáº·c Intel)- macOS (Apple Silicon hoáº·c Intel)

- Go 1.22+- Go 1.22+

- FFmpeg vá»›i há»— trá»£ AVFoundation- FFmpeg vá»›i há»— trá»£ AVFoundation

- Ollama CLI- Ollama CLI

- Python 3.9+ vá»›i PhoWhisper- Python 3.9+ vá»›i PhoWhisper

- Edge TTS (Python package)- Edge TTS (Python package)



## ğŸ“¦ CÃ i Äáº·t



### 1. CÃ i Ä‘áº·t Homebrew (náº¿u chÆ°a cÃ³)## CÃ i Ä‘áº·t



```bash### 1. CÃ i Ä‘áº·t Homebrew (náº¿u chÆ°a cÃ³)### 1. Install Homebrew (if not already installed)

/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

```### 1. CÃ i Ä‘áº·t Go



### 2. CÃ i Ä‘áº·t Go vÃ  FFmpeg```bash```bash



```bash```bash

brew install go ffmpeg

```brew install go/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"



### 3. CÃ i Ä‘áº·t Ollama```



```bash``````

# CÃ i Ä‘áº·t Ollama CLI

brew install ollama### 2. CÃ i Ä‘áº·t FFmpeg



# Khá»Ÿi Ä‘á»™ng Ollama service

ollama serve &

```bash

# Pull model gemma2:2b (hoáº·c model nháº¹ khÃ¡c)

ollama pull gemma2:2bbrew install ffmpeg### 2. CÃ i Ä‘áº·t ffmpeg vÃ  ffplay### 2. Install ffmpeg and ffplay

```

```

**CÃ¡c model nháº¹ Ä‘Æ°á»£c Ä‘á» xuáº¥t:**

- `gemma2:2b` (2B parameters) - nhá» gá»n, hiá»‡u suáº¥t tá»‘t```bash```bash

- `phi-3-mini` (3.8B parameters) - cÃ¢n báº±ng tá»‘c Ä‘á»™ vÃ  cháº¥t lÆ°á»£ng

- `tinyllama` (1.1B parameters) - ráº¥t nháº¹, phÃ¹ há»£p mÃ¡y yáº¿u### 3. CÃ i Ä‘áº·t Ollama



### 4. CÃ i Ä‘áº·t PhoWhisperbrew install ffmpegbrew install ffmpeg



```bash```bash

# Táº¡o virtual environment cho Python

python3 -m venv phowhisper-env# CÃ i Ä‘áº·t Ollama CLI``````

source phowhisper-env/bin/activate

brew install ollama

# CÃ i Ä‘áº·t dependencies

pip install -r requirements.txt



# Model vinai/PhoWhisper-small (~157MB) sáº½ tá»± Ä‘á»™ng download khi cháº¡y láº§n Ä‘áº§u# Khá»Ÿi Ä‘á»™ng Ollama service

```

ollama serve &### 3. CÃ i Ä‘áº·t Go 1.22+ (náº¿u chÆ°a cÃ³)### 3. Install Go 1.22+ (if not already installed)

**LÆ°u Ã½ quan trá»ng:** Cáº­p nháº­t shebang trong `scripts/phowhisper_transcribe.py` vá»›i Ä‘Æ°á»ng dáº«n Python cá»§a báº¡n:

```python

#!/path/to/your/phowhisper-env/bin/python3

```# Pull model phi-3-mini (hoáº·c model nháº¹ khÃ¡c)```bash```bash



VÃ­ dá»¥:ollama pull phi-3-mini

```python

#!/Users/phamthetruong/phowhisper-env/bin/python3```brew install gobrew install go

```



### 5. CÃ i Ä‘áº·t Edge TTS

CÃ¡c model nháº¹ Ä‘Æ°á»£c Ä‘á» xuáº¥t:``````

```bash

# KÃ­ch hoáº¡t Python virtual environment (náº¿u chÆ°a)- `phi-3-mini` (3.8B parameters) - cÃ¢n báº±ng tá»‘c Ä‘á»™ vÃ  cháº¥t lÆ°á»£ng

source phowhisper-env/bin/activate

- `tinyllama` (1.1B parameters) - ráº¥t nháº¹, phÃ¹ há»£p mÃ¡y yáº¿u

# CÃ i Ä‘áº·t Edge TTS

pip install edge-tts- `gemma:2b` (2B parameters) - nhá» gá»n, hiá»‡u suáº¥t tá»‘t

```

### 4. Láº¥y OpenAI API Key### 4. Get an OpenAI API Key

### 6. Cáº¥p quyá»n cho Terminal

### 4. Build whisper.cpp

Cáº¥p quyá»n cho Terminal/iTerm2 truy cáº­p microphone trong **System Preferences â†’ Privacy & Security â†’ Microphone**.

- Truy cáº­p https://platform.openai.com/api-keys- Visit https://platform.openai.com/api-keys

### 7. Clone vÃ  build project

```bash

```bash

# Clone repository# Clone repository- Táº¡o API key má»›i- Create a new API key

git clone https://github.com/truong-nautilus/smart-home-ai.git

cd smart-home-aigit clone https://github.com/ggerganov/whisper.cpp.git



# Táº£i dependenciescd whisper.cpp- Thiáº¿t láº­p biáº¿n mÃ´i trÆ°á»ng:- Set it as an environment variable:

go mod download



# Build

go build -o smart-home-ai cmd/assistant/main.go# Build

```

make

## âš™ï¸ Cáº¥u HÃ¬nh

```bash```bash

Táº¡o file `.env` trong thÆ° má»¥c gá»‘c cá»§a project:

# Download model nhá» (base hoáº·c tiny)

```env

# PhoWhisper configurationbash ./models/download-ggml-model.sh baseexport OPENAI_API_KEY="sk-your-api-key-here"export OPENAI_API_KEY="sk-your-api-key-here"

PHOWHISPER_SCRIPT=scripts/phowhisper_transcribe.py

# Hoáº·c model nhá» hÆ¡n:

# Ollama configuration

OLLAMA_MODEL=gemma2:2b# bash ./models/download-ggml-model.sh tiny``````



# Edge TTS configuration

EDGE_TTS_VOICE=vi-VN-NamMinhNeural

# Giá»ng khÃ¡c: vi-VN-HoaiMyNeural (ná»¯)# LÆ°u Ä‘Æ°á»ng dáº«n binary vÃ  model

```

# Binary: ./main

## â–¶ï¸ Cháº¡y á»¨ng Dá»¥ng

# Model: ./models/ggml-base.bin**Máº¹o:** ThÃªm lá»‡nh export vÃ o `~/.zshrc` Ä‘á»ƒ lÆ°u vÄ©nh viá»…n:**Tip:** Add the export command to your `~/.zshrc` to persist it:

```bash

# Cháº¡y trá»±c tiáº¿p```

./smart-home-ai

```bash```bash

# Hoáº·c dÃ¹ng go run

go run cmd/assistant/main.go### 5. Clone vÃ  build project

```

echo 'export OPENAI_API_KEY="sk-your-api-key-here"' >> ~/.zshrcecho 'export OPENAI_API_KEY="sk-your-api-key-here"' >> ~/.zshrc

### Káº¿t Quáº£ Mong Äá»£i:

```bash

```

ğŸš€ Trá»£ lÃ½ AI Ä‘Ã£ sáºµn sÃ ng!# Clone repositorysource ~/.zshrcsource ~/.zshrc

ğŸ“Œ CÃ¡ch dÃ¹ng: Nháº¥n ENTER láº§n 1 â†’ ghi Ã¢m â†’ nháº¥n ENTER láº§n 2 â†’ xá»­ lÃ½

ğŸ›‘ Nháº¥n Ctrl+C Ä‘á»ƒ thoÃ¡tgit clone <repository-url>

ğŸ¤ Äang ghi Ã¢m... (nháº¥n ENTER Ä‘á»ƒ dá»«ng)

âœ… ÄÃ£ ghi Ã¢m xongcd smart-home-ai``````

ğŸ§  Äang chuyá»ƒn giá»ng nÃ³i thÃ nh vÄƒn báº£n...

[ğŸ” PhoWhisper output: "HÃ´m nay thá»i tiáº¿t tháº¿ nÃ o"]

ğŸ“ CÃ¢u há»i: "HÃ´m nay thá»i tiáº¿t tháº¿ nÃ o"

ğŸ¤– Äang xá»­ lÃ½ cÃ¢u há»i...# Táº£i dependencies

ğŸ’¬ Tráº£ lá»i: "ChÃ o báº¡n! HÃ´m nay thá»i tiáº¿t Ä‘áº¹p láº¯m nhÃ©..."

ğŸ”Š Äang tá»•ng há»£p giá»ng nÃ³i...go mod download

âœ… Tá»•ng há»£p giá»ng nÃ³i thÃ nh cÃ´ng

ğŸ”ˆ Äang phÃ¡t Ã¢m thanh pháº£n há»“i...Hoáº·c táº¡o file `.env`:## ğŸš€ Setup

âœ… HoÃ n thÃ nh!

âœ¨ HoÃ n táº¥t! Sáºµn sÃ ng cho láº§n tiáº¿p theo...# Build

```

go build -o smart-home-ai cmd/assistant/main.go```bash

## ğŸ› ï¸ Troubleshooting

```

### Lá»—i: "ffmpeg: No such file or directory"

echo 'OPENAI_API_KEY=sk-your-api-key-here' > .env1. **Clone or navigate to the project directory:**

```bash

# Kiá»ƒm tra ffmpeg Ä‘Ã£ cÃ i Ä‘áº·t chÆ°a## Cáº¥u hÃ¬nh

which ffmpeg

``````bash

# CÃ i Ä‘áº·t náº¿u chÆ°a cÃ³

brew install ffmpegTáº¡o file `.env` trong thÆ° má»¥c gá»‘c cá»§a project:

```

cd /Users/phamthetruong/github/smart-home-ai

### Lá»—i: "ollama: command not found"

```env

```bash

# CÃ i Ä‘áº·t Ollama# Whisper.cpp configuration## ğŸš€ CÃ i Äáº·t```

brew install ollama

WHISPER_CPP_BIN=/path/to/whisper.cpp/main

# Khá»Ÿi Ä‘á»™ng service

ollama serve &WHISPER_CPP_MODEL=/path/to/whisper.cpp/models/ggml-base.bin



# Pull model

ollama pull gemma2:2b

```# Ollama configuration1. **Di chuyá»ƒn Ä‘áº¿n thÆ° má»¥c dá»± Ã¡n:**2. **Download dependencies:**



### Lá»—i: "PhoWhisper khÃ´ng nháº­n diá»‡n Ä‘Æ°á»£c vÄƒn báº£n"OLLAMA_MODEL=phi-3-mini



Kiá»ƒm tra láº¡i:```bash```bash

1. ÄÆ°á»ng dáº«n shebang trong `scripts/phowhisper_transcribe.py`

2. Virtual environment Ä‘Ã£ cÃ i Ä‘á»§ dependencies: `pip install -r requirements.txt`# MacTTS configuration (optional)

3. Quyá»n thá»±c thi: `chmod +x scripts/phowhisper_transcribe.py`

MACTTS_VOICE=Alexcd /Users/phamthetruong/github/smart-home-aigo mod tidy

### Lá»—i: "avfoundation: Cannot find device"

```

Cáº¥p quyá»n cho Terminal/iTerm2 truy cáº­p microphone trong **System Preferences â†’ Privacy & Security**.

``````

Liá»‡t kÃª cÃ¡c thiáº¿t bá»‹ cÃ³ sáºµn:

**CÃ¡c giá»ng nÃ³i macOS kháº£ dá»¥ng:**

```bash

ffmpeg -f avfoundation -list_devices true -i ""- `Alex` (Má»¹, nam)

```

- `Samantha` (Má»¹, ná»¯)

Káº¿t quáº£ sáº½ hiá»ƒn thá»‹:

```- `Daniel` (Anh, nam)2. **Táº£i cÃ¡c dependency:**## â–¶ï¸ Run

[:0] Built-in Microphone

[:1] External Microphone- `Victoria` (Anh, ná»¯)

```

- Xem danh sÃ¡ch Ä‘áº§y Ä‘á»§: `say -v ?````bash

## ğŸ“¦ Dependencies



- **Go 1.22+**

- **github.com/sashabaranov/go-openai** v1.20.4 - OpenAI Go client (cho tÆ°Æ¡ng thÃ­ch)## Cháº¡y á»©ng dá»¥nggo mod tidy**Note:** The project now uses Clean Architecture. See [ARCHITECTURE.md](ARCHITECTURE.md) for details.

- **github.com/joho/godotenv** v1.5.1 - Táº£i biáº¿n mÃ´i trÆ°á»ng tá»« .env

- **ffmpeg** - Báº¯t vÃ  phÃ¡t Ã¢m thanh/video

- **Python Libraries:**

  - torch >= 2.0.0```bash```

  - transformers >= 4.30.0

  - librosa >= 0.10.0# Cháº¡y trá»±c tiáº¿p

  - edge-tts

./smart-home-ai```bash

## ğŸ“ Cáº¥u TrÃºc Dá»± Ãn



```

smart-home-ai/# Hoáº·c dÃ¹ng go run## â–¶ï¸ Cháº¡y á»¨ng Dá»¥ng# Run directly

â”œâ”€â”€ cmd/assistant/              # Äiá»ƒm vÃ o á»©ng dá»¥ng

â”‚   â””â”€â”€ main.go                 # Dependency injectiongo run cmd/assistant/main.go

â”œâ”€â”€ internal/

â”‚   â”œâ”€â”€ domain/                 # Logic nghiá»‡p vá»¥ cá»‘t lÃµi```go run cmd/assistant/main.go

â”‚   â”‚   â”œâ”€â”€ entity.go           # CÃ¡c entity nghiá»‡p vá»¥

â”‚   â”‚   â””â”€â”€ repository.go       # Interface (ports)

â”‚   â”œâ”€â”€ usecase/                # Logic á»©ng dá»¥ng

â”‚   â”‚   â””â”€â”€ assistant.go        # Äiá»u phá»‘i quy trÃ¬nh## Luá»“ng hoáº¡t Ä‘á»™ng**LÆ°u Ã½:** Dá»± Ã¡n sá»­ dá»¥ng Clean Architecture. Xem [KY_THUAT.md](KY_THUAT.md) Ä‘á»ƒ biáº¿t chi tiáº¿t.

â”‚   â””â”€â”€ infrastructure/         # Adapter dá»‹ch vá»¥ bÃªn ngoÃ i

â”‚       â”œâ”€â”€ phowhisper/         # PhoWhisper recognizer

â”‚       â”‚   â””â”€â”€ recognizer.go

â”‚       â”œâ”€â”€ ollama/             # Ollama AI client1. **Chá»¥p áº£nh tá»« camera** - FFmpeg capture má»™t frame tá»« camera tÃ­ch há»£p# Or build binary

â”‚       â”‚   â””â”€â”€ client.go

â”‚       â”œâ”€â”€ edgetts/            # Edge TTS synthesizer2. **Ghi Ã¢m cÃ¢u há»i** - FFmpeg ghi Ã¢m 5 giÃ¢y tá»« microphone

â”‚       â”‚   â””â”€â”€ synthesizer.go

â”‚       â”œâ”€â”€ media/              # FFmpeg wrapper3. **Chuyá»ƒn giá»ng nÃ³i thÃ nh text** - whisper.cpp transcribe file audio```bashgo build -o smart-home-ai cmd/assistant/main.go

â”‚       â”‚   â””â”€â”€ ffmpeg.go

â”‚       â””â”€â”€ keyboard/           # Keyboard listener4. **PhÃ¢n tÃ­ch Ä‘a phÆ°Æ¡ng thá»©c** - Ollama xá»­ lÃ½ text + áº£nh

â”‚           â””â”€â”€ listener.go

â”œâ”€â”€ scripts/5. **PhÃ¡t giá»ng nÃ³i pháº£n há»“i** - macOS `say` Ä‘á»c cÃ¢u tráº£ lá»i# Cháº¡y trá»±c tiáº¿p./smart-home-ai

â”‚   â””â”€â”€ phowhisper_transcribe.py  # Python script cho PhoWhisper

â”œâ”€â”€ pkg/logger/                 # Tiá»‡n Ã­ch chia sáº»

â”‚   â””â”€â”€ console.go

â”œâ”€â”€ requirements.txt            # Python dependencies## Cáº¥u trÃºc thÆ° má»¥cgo run cmd/assistant/main.go```

â”œâ”€â”€ .env                        # Biáº¿n mÃ´i trÆ°á»ng

â”œâ”€â”€ go.mod                      # Äá»‹nh nghÄ©a Go module

â””â”€â”€ README.md

``````



## ğŸ§¹ Dá»n Dáº¹psmart-home-ai/



CÃ¡c file táº¡m (`audio.wav`, `reply.mp3`) Ä‘Æ°á»£c tá»± Ä‘á»™ng dá»n dáº¹p sau má»—i láº§n cháº¡y.â”œâ”€â”€ cmd/# Hoáº·c build file thá»±c thi### Expected Output:



## ğŸ“ Ghi ChÃºâ”‚   â””â”€â”€ assistant/



- Thá»i lÆ°á»£ng thu Ã¢m: **Nháº¥n vÃ  giá»¯ ENTER** Ä‘á»ƒ báº¯t Ä‘áº§u, **nháº£ ENTER** Ä‘á»ƒ dá»«ngâ”‚       â””â”€â”€ main.go              # Entry pointgo build -o tro-ly-thong-minh cmd/assistant/main.go```

- Ã‚m thanh thu á»Ÿ **mono vá»›i táº§n sá»‘ 16kHz** (tá»‘i Æ°u cho PhoWhisper)

- Edge TTS sá»­ dá»¥ng giá»ng **vi-VN-NamMinhNeural** (nam) hoáº·c **vi-VN-HoaiMyNeural** (ná»¯)â”œâ”€â”€ internal/



## ğŸ¨ TÃ¹y Chá»‰nhâ”‚   â”œâ”€â”€ domain/./tro-ly-thong-minh[15:04:05] ğŸ¥ Capturing image from FaceTime HD camera...



Chá»‰nh sá»­a cÃ¡c file Ä‘á»ƒ tÃ¹y chá»‰nh:â”‚   â”‚   â”œâ”€â”€ entity.go            # Domain entities

- `cmd/assistant/main.go` - Chá»n model Ollama khÃ¡c

- `.env` - Thay Ä‘á»•i giá»ng Edge TTS (vi-VN-HoaiMyNeural cho giá»ng ná»¯)â”‚   â”‚   â””â”€â”€ repository.go        # Repository interfaces (ports)```[15:04:06] âœ… Image captured successfully

- `scripts/phowhisper_transcribe.py` - Thay Ä‘á»•i batch_size, chunk_length_s Ä‘á»ƒ tá»‘i Æ°u performance

â”‚   â”œâ”€â”€ usecase/

### So sÃ¡nh PhoWhisper vs Whisper.cpp

â”‚   â”‚   â””â”€â”€ assistant.go         # Business logic orchestration[15:04:06] ğŸ¤ Recording audio from microphone (5 seconds)...

| TiÃªu chÃ­ | PhoWhisper | Whisper.cpp |

|----------|-----------|-------------|â”‚   â””â”€â”€ infrastructure/

| **Model Size** | 157MB | 1.5GB (medium) |

| **Äá»™ chÃ­nh xÃ¡c (Tiáº¿ng Viá»‡t)** | â­â­â­â­â­ | â­â­â­â­ |â”‚       â”œâ”€â”€ media/### Káº¿t Quáº£ Mong Äá»£i:[15:04:11] âœ… Audio recorded successfully

| **Tá»‘c Ä‘á»™** | Trung bÃ¬nh | Nhanh |

| **Tá»‘i Æ°u cho** | Tiáº¿ng Viá»‡t | Äa ngÃ´n ngá»¯ |â”‚       â”‚   â””â”€â”€ ffmpeg.go        # FFmpeg adapter

| **Setup** | Dá»… (pip install) | Phá»©c táº¡p (build cmake) |

â”‚       â”œâ”€â”€ whispercpp/```[15:04:11] ğŸ§  Transcribing speech with Whisper API...

## ğŸ—ï¸ Kiáº¿n TrÃºc

â”‚       â”‚   â””â”€â”€ recognizer.go    # Whisper.cpp adapter

Dá»± Ã¡n sá»­ dá»¥ng **Clean Architecture** vá»›i:

- **Domain Layer**: Entity vÃ  interface cá»‘t lÃµiâ”‚       â”œâ”€â”€ ollama/[15:04:05] ğŸ¥ Äang báº¯t áº£nh tá»« camera FaceTime HD...[15:04:12] ğŸ“ Transcription: "What do you see in front of me?"

- **Use Case Layer**: Logic Ä‘iá»u phá»‘i nghiá»‡p vá»¥

- **Infrastructure Layer**: Triá»ƒn khai adapterâ”‚       â”‚   â””â”€â”€ client.go        # Ollama adapter

- **Delivery Layer**: Äiá»ƒm vÃ o vÃ  dependency injection

â”‚       â””â”€â”€ mactts/[15:04:06] âœ… ÄÃ£ báº¯t áº£nh thÃ nh cÃ´ng[15:04:12] ğŸ¤– GPT-4o-mini reasoning on text + image...

## ğŸ“š TÃ i Liá»‡u Bá»• Sung

â”‚           â””â”€â”€ synthesizer.go   # MacTTS adapter

- **[ARCHITECTURE.md](docs/ARCHITECTURE.md)** - Kiáº¿n trÃºc chi tiáº¿t

- **[QUICKSTART.md](docs/QUICKSTART.md)** - HÆ°á»›ng dáº«n nhanhâ”œâ”€â”€ pkg/[15:04:06] ğŸ¤ Äang thu Ã¢m tá»« microphone (5 giÃ¢y)...[15:04:14] ğŸ’¬ GPT Response: "I can see you're sitting at a desk with a laptop..."



## ğŸ“„ Giáº¥y PhÃ©pâ”‚   â””â”€â”€ logger/



MITâ”‚       â””â”€â”€ console.go           # Console logger[15:04:11] âœ… ÄÃ£ thu Ã¢m thÃ nh cÃ´ng[15:04:14] ğŸ”Š Converting response to speech with TTS...



---â”œâ”€â”€ go.mod



**ChÃºc báº¡n láº­p trÃ¬nh vui váº»!** ğŸ¯â”œâ”€â”€ go.sum[15:04:11] ğŸ§  Äang chuyá»ƒn giá»ng nÃ³i thÃ nh vÄƒn báº£n vá»›i Whisper API...[15:04:16] âœ… Speech generated successfully


â”œâ”€â”€ .env                         # Configuration (táº¡o má»›i)

â””â”€â”€ README.md[15:04:12] ğŸ“ VÄƒn báº£n: "Báº¡n tháº¥y gÃ¬ trÆ°á»›c máº·t tÃ´i?"[15:04:16] ğŸ”ˆ Playing audio response...

```

[15:04:12] ğŸ¤– GPT-4o-mini Ä‘ang phÃ¢n tÃ­ch vÄƒn báº£n + hÃ¬nh áº£nh...[15:04:20] âœ… Done!

## Troubleshooting

[15:04:14] ğŸ’¬ Pháº£n há»“i GPT: "TÃ´i tháº¥y báº¡n Ä‘ang ngá»“i á»Ÿ bÃ n lÃ m viá»‡c vá»›i laptop..."```

### Lá»—i: "ffmpeg: No such file or directory"

[15:04:14] ğŸ”Š Äang chuyá»ƒn pháº£n há»“i thÃ nh giá»ng nÃ³i vá»›i TTS...

```bash

# Kiá»ƒm tra ffmpeg Ä‘Ã£ cÃ i Ä‘áº·t chÆ°a[15:04:16] âœ… ÄÃ£ táº¡o giá»ng nÃ³i thÃ nh cÃ´ng## ğŸ” Permissions

which ffmpeg

[15:04:16] ğŸ”ˆ Äang phÃ¡t Ã¢m thanh pháº£n há»“i...

# CÃ i Ä‘áº·t náº¿u chÆ°a cÃ³

brew install ffmpeg[15:04:20] âœ… HoÃ n thÃ nh!On first run, macOS will ask for permissions:

```

```- **Camera access** - Required to capture images

### Lá»—i: "ollama: command not found"

- **Microphone access** - Required to record audio

```bash

# CÃ i Ä‘áº·t Ollama## ğŸ” Quyá»n Truy Cáº­p

brew install ollama

Click "Allow" when prompted.

# Khá»Ÿi Ä‘á»™ng service

ollama serve &Láº§n cháº¡y Ä‘áº§u tiÃªn, macOS sáº½ yÃªu cáº§u quyá»n:



# Pull model- **Truy cáº­p Camera** - Cáº§n thiáº¿t Ä‘á»ƒ báº¯t áº£nh## ğŸ› ï¸ Troubleshooting

ollama pull phi-3-mini

```- **Truy cáº­p Microphone** - Cáº§n thiáº¿t Ä‘á»ƒ thu Ã¢m



### Lá»—i: "whisper.cpp: khÃ´ng tÃ¬m tháº¥y binary"### Camera/Microphone Not Found



Kiá»ƒm tra láº¡i Ä‘Æ°á»ng dáº«n trong file `.env`:Nháº¥p "Cho phÃ©p" khi Ä‘Æ°á»£c nháº¯c.If you get an error about device not found, list available devices:



```env```bash

WHISPER_CPP_BIN=/Users/yourusername/whisper.cpp/main

WHISPER_CPP_MODEL=/Users/yourusername/whisper.cpp/models/ggml-base.bin## ğŸ› ï¸ Kháº¯c Phá»¥c Sá»± Cá»‘ffmpeg -f avfoundation -list_devices true -i ""

```

```

### Lá»—i: "avfoundation: Cannot find device"

### KhÃ´ng TÃ¬m Tháº¥y Camera/Microphone

Cáº¥p quyá»n cho Terminal/iTerm2 truy cáº­p camera vÃ  microphone trong **System Preferences â†’ Privacy & Security**.

Náº¿u gáº·p lá»—i vá» thiáº¿t bá»‹ khÃ´ng tÃ¬m tháº¥y, liá»‡t kÃª cÃ¡c thiáº¿t bá»‹ cÃ³ sáºµn:This will show something like:

## License

```bash```

MIT

ffmpeg -f avfoundation -list_devices true -i ""[0] FaceTime HD Camera

## Contributing

```[1] External Camera

Pull requests are welcome!

[:0] Built-in Microphone

Káº¿t quáº£ sáº½ hiá»ƒn thá»‹:[:1] External Microphone

``````

[0] FaceTime HD Camera

[1] External CameraUpdate `main.go` if needed:

[:0] Built-in Microphone- For video: change `"-i", "0"` to your camera index

[:1] External Microphone- For audio: change `"-i", ":0"` to your microphone index

```

### API Key Not Set

Cáº­p nháº­t `internal/infrastructure/media/ffmpeg.go` náº¿u cáº§n:If you see `OPENAI_API_KEY environment variable not set`:

- Vá»›i video: thay Ä‘á»•i `"-i", "0"` thÃ nh chá»‰ sá»‘ camera cá»§a báº¡n```bash

- Vá»›i audio: thay Ä‘á»•i `"-i", ":0"` thÃ nh chá»‰ sá»‘ microphone cá»§a báº¡nexport OPENAI_API_KEY="your-key-here"

```

### ChÆ°a Thiáº¿t Láº­p API Key

Náº¿u tháº¥y `ChÆ°a thiáº¿t láº­p biáº¿n mÃ´i trÆ°á»ng OPENAI_API_KEY`:### FFmpeg Not Installed

```bashIf you get `executable file not found`:

export OPENAI_API_KEY="your-key-here"```bash

```brew install ffmpeg

```

Hoáº·c táº¡o file `.env`:

```bash## ğŸ“¦ Dependencies

echo 'OPENAI_API_KEY=sk-your-key-here' > .env

```- **Go 1.22+**

- **github.com/sashabaranov/go-openai** v1.20.4 - OpenAI Go client

### ChÆ°a CÃ i FFmpeg- **ffmpeg** - Audio/video capture and playback

Náº¿u gáº·p lá»—i `executable file not found`:- **OpenAI APIs:**

```bash  - Whisper (speech-to-text)

brew install ffmpeg  - GPT-4o-mini (multimodal reasoning)

```  - TTS-1 (text-to-speech)



## ğŸ“¦ CÃ¡c Dependency## ğŸ§¹ Cleanup



- **Go 1.22+**Temporary files (`frame.jpg`, `audio.wav`, `reply.mp3`) are automatically cleaned up after each run.

- **github.com/sashabaranov/go-openai** v1.20.4 - OpenAI Go client

- **github.com/joho/godotenv** v1.5.1 - Táº£i biáº¿n mÃ´i trÆ°á»ng tá»« .env## ğŸ“ Notes

- **ffmpeg** - Báº¯t vÃ  phÃ¡t Ã¢m thanh/video

- **OpenAI APIs:**- The assistant records **5 seconds** of audio by default (configurable in `main.go`)

  - Whisper (chuyá»ƒn giá»ng nÃ³i thÃ nh vÄƒn báº£n)- Camera captures a **640x480** frame (configurable)

  - GPT-4o-mini (phÃ¢n tÃ­ch Ä‘a phÆ°Æ¡ng thá»©c)- Audio is recorded in **mono at 16kHz** (optimal for Whisper)

  - TTS-1 (chuyá»ƒn vÄƒn báº£n thÃ nh giá»ng nÃ³i)- TTS uses the **Alloy voice** (configurable to: alloy, echo, fable, onyx, nova, shimmer)



## ğŸ“ Cáº¥u TrÃºc Dá»± Ãn## ğŸ¨ Customization



```Edit `main.go` to customize:

smart-home-ai/- `audioDuration` - Change recording length

â”œâ”€â”€ cmd/assistant/              # Äiá»ƒm vÃ o á»©ng dá»¥ng- `Voice` - Change TTS voice in `textToSpeech()`

â”‚   â””â”€â”€ main.go                 # Dependency injection- `video_size` - Change camera resolution in `captureImage()`

â”œâ”€â”€ internal/- `Model` - Switch between GPT models

â”‚   â”œâ”€â”€ domain/                 # Logic nghiá»‡p vá»¥ cá»‘t lÃµi

â”‚   â”‚   â”œâ”€â”€ entity.go           # CÃ¡c entity nghiá»‡p vá»¥## ğŸ“„ License

â”‚   â”‚   â””â”€â”€ repository.go       # Interface (ports)

â”‚   â”œâ”€â”€ usecase/                # Logic á»©ng dá»¥ngMIT

â”‚   â”‚   â””â”€â”€ assistant.go        # Äiá»u phá»‘i quy trÃ¬nh
â”‚   â””â”€â”€ infrastructure/         # Adapter dá»‹ch vá»¥ bÃªn ngoÃ i
â”‚       â”œâ”€â”€ openai/             # OpenAI API client
â”‚       â”‚   â””â”€â”€ client.go
â”‚       â””â”€â”€ media/              # FFmpeg wrapper
â”‚           â””â”€â”€ ffmpeg.go
â”œâ”€â”€ pkg/logger/                 # Tiá»‡n Ã­ch chia sáº»
â”‚   â””â”€â”€ console.go
â”œâ”€â”€ .env                        # Biáº¿n mÃ´i trÆ°á»ng
â”œâ”€â”€ .gitignore                  # Quy táº¯c ignore Git
â”œâ”€â”€ go.mod                      # Äá»‹nh nghÄ©a Go module
â””â”€â”€ CÃ¡c file tÃ i liá»‡u
```

## ğŸ§¹ Dá»n Dáº¹p

CÃ¡c file táº¡m (`hinh-anh.jpg`, `am-thanh.wav`, `tra-loi.mp3`) Ä‘Æ°á»£c tá»± Ä‘á»™ng dá»n dáº¹p sau má»—i láº§n cháº¡y.

## ğŸ“ Ghi ChÃº

- Trá»£ lÃ½ thu Ã¢m **5 giÃ¢y** máº·c Ä‘á»‹nh (cÃ³ thá»ƒ cáº¥u hÃ¬nh trong `internal/usecase/assistant.go`)
- Camera báº¯t áº£nh **640x480** (cÃ³ thá»ƒ cáº¥u hÃ¬nh)
- Ã‚m thanh thu á»Ÿ **mono vá»›i táº§n sá»‘ 16kHz** (tá»‘i Æ°u cho Whisper)
- TTS sá»­ dá»¥ng giá»ng **Alloy** (cÃ³ thá»ƒ chá»n: alloy, echo, fable, onyx, nova, shimmer)

## ğŸ¨ TÃ¹y Chá»‰nh

Chá»‰nh sá»­a cÃ¡c file Ä‘á»ƒ tÃ¹y chá»‰nh:
- `internal/usecase/assistant.go` - Thay Ä‘á»•i thá»i lÆ°á»£ng thu Ã¢m (`thoiLuongThuAm`)
- `internal/infrastructure/openai/client.go` - Thay Ä‘á»•i giá»ng TTS trong phÆ°Æ¡ng thá»©c `TongHop()`
- `internal/infrastructure/media/ffmpeg.go` - Thay Ä‘á»•i Ä‘á»™ phÃ¢n giáº£i camera trong `BatAnh()`
- Chuyá»ƒn Ä‘á»•i giá»¯a cÃ¡c model GPT khÃ¡c nhau

## ğŸ—ï¸ Kiáº¿n TrÃºc

Dá»± Ã¡n sá»­ dá»¥ng **Clean Architecture** vá»›i:
- **Domain Layer**: Entity vÃ  interface cá»‘t lÃµi
- **Use Case Layer**: Logic Ä‘iá»u phá»‘i nghiá»‡p vá»¥
- **Infrastructure Layer**: Triá»ƒn khai adapter
- **Delivery Layer**: Äiá»ƒm vÃ o vÃ  dependency injection

Xem [KY_THUAT.md](KY_THUAT.md) Ä‘á»ƒ biáº¿t chi tiáº¿t vá» kiáº¿n trÃºc.

## ğŸ“š TÃ i Liá»‡u Bá»• Sung

- **[HUONG_DAN_NHANH.md](HUONG_DAN_NHANH.md)** - HÆ°á»›ng dáº«n nhanh 2 phÃºt
- **[KY_THUAT.md](KY_THUAT.md)** - TÃ¬m hiá»ƒu sÃ¢u vá» thiáº¿t káº¿
- **[SO_DO_KY_THUAT.md](SO_DO_KY_THUAT.md)** - HÆ°á»›ng dáº«n trá»±c quan
- **[TOM_TAT_TAI_CAU_TRUC.md](TOM_TAT_TAI_CAU_TRUC.md)** - Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i
- **[README_EN.md](README_EN.md)** - English version

## ğŸ“„ Giáº¥y PhÃ©p

MIT

---

**ChÃºc báº¡n láº­p trÃ¬nh vui váº»!** ğŸ¯
